(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{57563:function(e,t,s){Promise.resolve().then(s.bind(s,5896))},99267:function(e,t,s){"use strict";var a=s(20326);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},5896:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var a=s(48217),l=s(47327),r=s(72758),i=s(99267),n=s(58623),c=s(24102),d=s(36211),o=s(13535);let m=(0,s(36438).Z)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);var x=s(87418),h=s(76402),u=s(79032),p=s(47946),g=s(89172),f=s(7184),j=s(63023),b=s(27096),y=s(64903),N=s(41456),v=s(94883),w=s(71799);function _(){let e=(0,i.useRouter)(),[t,s]=(0,l.useState)(!0),[_,k]=(0,l.useState)([]),[D,I]=(0,l.useState)([]),[O,S]=(0,l.useState)([]),[Z,E]=(0,l.useState)([]);(0,l.useEffect)(()=>{M(),z()},[]);let M=async()=>{let{data:{user:t}}=await r.O.auth.getUser();if(!t){e.push("/login");return}let{data:s}=await r.O.from("profiles").select("role").eq("id",t.id).single();if((null==s?void 0:s.role)!=="admin"){e.push("/dashboard");return}},z=async()=>{try{let e=[];for(let t=29;t>=0;t--){let s=new Date;s.setDate(s.getDate()-t);let a=s.toISOString().split("T")[0],{count:l}=await r.O.from("profiles").select("*",{count:"exact",head:!0}).lte("created_at","".concat(a,"T23:59:59"));(t%5==0||t<7)&&e.push({date:a,users:l||0})}k(e);let{data:t}=await r.O.from("subscriptions").select("plan_id, status").eq("status","active"),s={free:0,monthly:0,annual:0,lifetime:0};null==t||t.forEach(e=>{s.hasOwnProperty(e.plan_id)&&s[e.plan_id]++}),S([{name:"مجاني",value:s.free,color:"#9CA3AF"},{name:"شهري",value:s.monthly,color:"#3B82F6"},{name:"سنوي",value:s.annual,color:"#9D4EDD"},{name:"مدى الحياة",value:s.lifetime,color:"#F59E0B"}]);let{data:a}=await r.O.from("campaigns").select("platform_id"),l={};null==a||a.forEach(e=>{l[e.platform_id]=(l[e.platform_id]||0)+1});let i=Object.entries(l).map(e=>{let[t,s]=e;return{platform:t,campaigns:s}}).sort((e,t)=>t.campaigns-e.campaigns).slice(0,6);I(i);let{data:n}=await r.O.from("profiles").select("id, full_name, total_points, created_at").order("total_points",{ascending:!1}).limit(10);if(n){let e=await Promise.all(n.map(async e=>{var t;let{data:s}=await r.O.auth.admin.getUserById(e.id);return{...e,email:(null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.email)||"غير متوفر"}}));E(e)}}catch(e){console.error("خطأ في تحميل الإحصائيات:",e)}finally{s(!1)}};return t?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"w-8 h-8"}),"الإحصائيات المتقدمة"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"تحليلات شاملة لأداء المنصة"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-primary"}),"نمو المستخدمين (آخر 30 يوم)"]}),(0,a.jsx)(x.h,{width:"100%",height:300,children:(0,a.jsxs)(h.w,{data:_,children:[(0,a.jsx)(u.q,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,a.jsx)(p.K,{dataKey:"date",tick:{fontSize:12},tickFormatter:e=>{let t=new Date(e);return"".concat(t.getDate(),"/").concat(t.getMonth()+1)}}),(0,a.jsx)(g.B,{tick:{fontSize:12}}),(0,a.jsx)(f.u,{}),(0,a.jsx)(j.x,{type:"monotone",dataKey:"users",stroke:"#9D4EDD",strokeWidth:3,name:"المستخدمين",dot:{r:4,fill:"#9D4EDD"}})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5 text-primary"}),"توزيع الاشتراكات"]}),(0,a.jsx)(x.h,{width:"100%",height:300,children:(0,a.jsxs)(b.u,{children:[(0,a.jsx)(y.b,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:e=>"".concat(e.name," (").concat(e.value,")"),outerRadius:100,fill:"#8884d8",dataKey:"value",children:O.map((e,t)=>(0,a.jsx)(N.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(f.u,{})]})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 text-primary"}),"استخدام المنصات (عدد الحملات)"]}),(0,a.jsx)(x.h,{width:"100%",height:300,children:(0,a.jsxs)(v.v,{data:D,children:[(0,a.jsx)(u.q,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,a.jsx)(p.K,{dataKey:"platform",tick:{fontSize:12}}),(0,a.jsx)(g.B,{tick:{fontSize:12}}),(0,a.jsx)(f.u,{}),(0,a.jsx)(w.$,{dataKey:"campaigns",fill:"#3B82F6",name:"الحملات",radius:[8,8,0,0]})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,a.jsx)(m,{className:"w-5 h-5 text-primary"}),"أكثر المستخدمين نشاطاً"]}),(0,a.jsx)("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:Z.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center font-bold text-primary",children:t+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.full_name||"غير محدد"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.email})]})]}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-primary",children:e.total_points}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"نقطة"})]})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"إحصائيات النقاط"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"إجمالي النقاط الممنوحة"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:Z.reduce((e,t)=>e+(t.total_points||0),0).toLocaleString()})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"متوسط النقاط لكل مستخدم"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:Z.length>0?Math.round(Z.reduce((e,t)=>e+(t.total_points||0),0)/Z.length):0})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"أعلى رصيد نقاط"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-600",children:Z.length>0?Z[0].total_points:0})]})]})]})]})})}},72758:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(7645).eI)("https://gigrtzamstdyynmvwljq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZ3J0emFtc3RkeXlubXZ3bGpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMDg5MDMsImV4cCI6MjA3NzU4NDkwM30.OZMTpBkAK2Zc4m0CyOdBbHsoAV_MS7FK-OpQNvuxgmc")}},function(e){e.O(0,[818,203,70,275,960,744],function(){return e(e.s=57563)}),_N_E=e.O()}]);